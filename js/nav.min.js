"use strict";
var _this = void 0,
  nav = document.querySelector("[data-respnav]"),
  menuToggle = document.querySelector("[data-respnav-trigger]"),
  menu = document.querySelector("[data-respnav-menu]"),
  BREAKPOINT = 768,
  debounce = function (a, i) {
    var o;
    return function () {
      for (var e = arguments.length, n = new Array(e), t = 0; t < e; t++)
        n[t] = arguments[t];
      var r = _this;
      clearTimeout(o),
        (o = setTimeout(function () {
          return a.apply(r, n);
        }, i));
    };
  },
  checkSizeForMenu = function () {
    window.innerWidth >= BREAKPOINT
      ? menu.removeAttribute("hidden")
      : menu.hasAttribute("hidden") || menu.setAttribute("hidden", "");
  },
  menuExpandButtonClick = function (e) {
    if (e.target.closest("[data-respnav-expandbutton]")) {
      var n = e.target.closest("[data-respnav-expandbutton]"),
        t = JSON.parse(n.getAttribute("aria-expanded"));
      n.setAttribute("aria-expanded", !t);
    }
  },
  setupMenuDropDowns = function () {
    var a = menu.querySelectorAll("[data-respnav-expandbutton]");
    a.forEach(function (e) {
      var n = Array.from(a),
        t = "childMenu-".concat(n.indexOf(e)),
        r = e.nextElementSibling;
      (e.style.display = "inline-flex"),
        r.classList.contains("mainnav__list--child") &&
          (e.setAttribute("aria-expanded", !1),
          e.setAttribute("aria-controls", t),
          (r.id = t));
    }),
      menu.addEventListener("click", menuExpandButtonClick),
      menu.querySelectorAll(".mainnav__listitem").forEach(function (e) {
        e.firstElementChild.addEventListener("focusin", closeAllDropdowns);
      });
    var e = Array.from(
        nav.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        )
      ),
      n = Array.from(
        document.body.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        )
      ),
      t = e[e.length - 1],
      r = n.indexOf(t);
    n[r + 1].addEventListener("focusin", closeAllDropdowns);
  },
  closeAllDropdowns = function () {
    menu.querySelectorAll("[data-respnav-expandbutton]").forEach(function (e) {
      return e.setAttribute("aria-expanded", !1);
    });
  },
  menuFocusTrap = function (e) {
    if ((27 == e.keyCode && openCloseMenu(), 9 == e.keyCode)) {
      var n = document.activeElement,
        t = Array.from(
          nav.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
          )
        ).filter(function (e) {
          return (
            !e.closest(".mainnav__list--child") ||
            "none" !==
              getComputedStyle(e.closest(".mainnav__list--child")).display
          );
        }),
        r = t.length,
        a = t.indexOf(n);
      e.shiftKey
        ? 0 === a && (e.preventDefault(), t[r - 1].focus())
        : a == r - 1 && (e.preventDefault(), t[0].focus());
    }
  },
  accessibleShowHide = function (e, n) {
    n ? e.setAttribute("aria-hidden", !0) : e.removeAttribute("aria-hidden");
  },
  openCloseMenu = function () {
    var n = JSON.parse(menuToggle.getAttribute("aria-expanded"));
    Array.from(document.body.children).forEach(function (e) {
      "SCRIPT" !== e.tagName &&
        "HEADER" !== e.tagName &&
        accessibleShowHide(e, !n);
    }),
      Array.from(document.getElementsByTagName("header")[0].children).forEach(
        function (e) {
          e.getElementsByTagName("nav").length
            ? Array.from(e.children).forEach(function (e) {
                "NAV" !== e.tagName && accessibleShowHide(e, !n);
              })
            : accessibleShowHide(e, !n);
        }
      ),
      n
        ? (window.removeEventListener("keydown", menuFocusTrap),
          menuToggle.setAttribute("aria-expanded", !n),
          setTimeout(function () {
            return (menu.hidden = !menu.hidden);
          }, 500))
        : (window.addEventListener("keydown", menuFocusTrap),
          (menu.hidden = !menu.hidden),
          setTimeout(function () {
            return menuToggle.setAttribute("aria-expanded", !n);
          }, 100)),
      document.documentElement.classList.toggle("no-scroll");
  };
window.addEventListener(
  "resize",
  debounce(function () {
    checkSizeForMenu();
  }, 200)
),
  window.addEventListener("DOMContentLoaded", checkSizeForMenu),
  window.addEventListener("DOMContentLoaded", setupMenuDropDowns),
  menuToggle.addEventListener("click", openCloseMenu);
